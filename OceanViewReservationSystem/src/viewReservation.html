<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>View Reservations | Ocean View Resort</title>
<link rel="stylesheet" href="css/styles.css">
</head>

<body>

<header class="main-header">
<div class="header-content">
    <h1>Ocean View Resort</h1>
    <p>Search &amp; View Reservations</p>
</div>
<a href="logout" class="logout-btn">Logout</a>
</header>

<nav class="sidebar">
    <a href="dashboard.html">Dashboard</a>
    <a href="addReservation.html">Add Reservation</a>
    <a href="viewReservation.html" class="active">View Reservation</a>
    <a href="checkRooms.html">Check Available Rooms</a>
    <a href="bill.html">Billing</a>
    <a href="help.html">Help</a>
</nav>

<main class="main-content">

<h2>Search Reservation</h2>

<div class="card">
    <label>Reservation Number</label>
    <input type="text" id="reservationNumber" placeholder="RES-XXXXXX">
    <button class="btn" onclick="searchReservation()">Search</button>
</div>

<div class="card" id="resultCard" style="display:none;">
    <h3>Reservation Details</h3>

    <p><strong>Reservation No:</strong> <span id="rNumber"></span></p>
    <p><strong>Guest Name:</strong> <span id="rGuest"></span></p>
    <p><strong>Room Number:</strong> <span id="rRoom"></span></p>
    <p><strong>Room Type:</strong> <span id="rType"></span></p>
    <p><strong>Price / Night:</strong> LKR <span id="rPrice"></span></p>
    <p><strong>Check-In:</strong> <span id="rIn"></span></p>
    <p><strong>Check-Out:</strong> <span id="rOut"></span></p>

    <button class="btn danger"
            onclick="deleteReservation(document.getElementById('rNumber').textContent)">
        Delete Reservation
    </button>
</div>

<div class="message error" id="notFound" style="display:none;">
   Reservation not found
</div>

<h2 style="margin-top:40px;">All Reservations</h2>

<div class="card">
<table class="data-table">
<thead>
<tr>
    <th>Reservation No</th>
    <th>Guest</th>
    <th>Room</th>
    <th>Room Type</th>
    <th>Check-In</th>
    <th>Check-Out</th>
    <th>Status</th>
    <th>Action</th>
</tr>
</thead>
<tbody id="reservationTable"></tbody>
</table>
</div>

</main>

<footer class="footer">
    &copy; 2026 Ocean View Resort â€“ Galle
</footer>

<script>

function searchReservation() {

    const number =
        document.getElementById("reservationNumber").value.trim();

    fetch("api/reservation?reservationNumber=" + number)
        .then(res => res.json())
        .then(data => {

            document.getElementById("resultCard").style.display = "none";
            document.getElementById("notFound").style.display = "none";

            if (!data.number) {
                document.getElementById("notFound").style.display = "block";
                return;
            }

            document.getElementById("rNumber").textContent = data.number;
            document.getElementById("rGuest").textContent = data.guest;
            document.getElementById("rRoom").textContent = data.room;
            document.getElementById("rType").textContent = data.roomType;
            document.getElementById("rPrice").textContent = data.price;
            document.getElementById("rIn").textContent = data.checkIn;
            document.getElementById("rOut").textContent = data.checkOut || "-";

            document.getElementById("resultCard").style.display = "block";
        });
}

fetch("api/reservations")
.then(res => res.json())
.then(data => {

    const tbody = document.getElementById("reservationTable");
    tbody.innerHTML = "";

    data.forEach(r => {
        tbody.innerHTML += `
        <tr>
            <td>${r.number}</td>
            <td>${r.guest}</td>
            <td>${r.room}</td>
            <td>${r.roomType}</td>
            <td>${r.checkIn}</td>
            <td>${r.checkOut || "-"}</td>
            <td>
                <span class="${r.status === 'CHECKED_OUT' ? 'badge success' : 'badge warning'}">
                    ${r.status}
                </span>
            </td>
            <td>
                <button class="btn danger"
                        onclick="deleteReservation('${r.number}')">
                    Delete
                </button>
            </td>
        </tr>`;
    });
});

function deleteReservation(reservationNumber) {

    if (!confirm("Are you sure you want to delete this reservation?")) return;

    fetch("deleteReservation", {
        method: "POST",
        headers: {"Content-Type": "application/x-www-form-urlencoded"},
        body: "reservationNumber=" + reservationNumber
    })
    .then(res => res.json())
    .then(data => {
        if (data.success) {
            alert("Reservation deleted successfully");
            location.reload();
        } else {
            alert("Delete failed");
        }
    });
}
</script>

</body>
</html>
